<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Chat</title>
  <style>
    body {
      background-color: #24142D;
      font-family: 'DM Sans', sans-serif;
      display: flex;
      justify-content: center;
      padding: 30px;
      color: white;
    }

    .chat-container {
      background-color: #433D8B;
      border: 1px solid white;
      border-radius: 30px;
      max-width: 430px;
      width: 100%;
      display: flex;
      flex-direction: column;
      height: 90vh;
      overflow: hidden;
    }

    .header, .footer {
      background-color: #2E236C;
      padding: 10px 20px;
    }

    .header {
      font-weight: bold;
      font-size: 20px;
    }

    .footer {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .message {
      margin-bottom: 15px;
      max-width: 80%;
      padding: 10px 15px;
      border-radius: 15px;
      position: relative;
    }

    .message.user {
      background-color: #2E236C;
      align-self: flex-end;
      color: white;
      border-bottom-right-radius: 0;
    }

    .message.bot {
      background-color: white;
      align-self: flex-start;
      color: #2E236C;
      border-bottom-left-radius: 0;
    }

    .timestamp {
      font-size: 10px;
      opacity: 0.6;
      margin-top: 5px;
    }

    input {
      flex: 1;
      padding: 12px;
      border-radius: 999px;
      border: none;
      outline: none;
    }

    button {
      background: none;
      border: none;
      cursor: pointer;
    }

    svg {
      stroke: white;
      stroke-width: 3.5;
    }

    .credit {
      font-size: 12px;
      opacity: 0.7;
      text-align: left;
      margin: 10px 20px;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="header">
      <span>
        <!-- Bot Icon -->
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/>
          <path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/>
        </svg>
        &nbsp; AI Chat
      </span>
    </div>

    <div class="messages" id="chat"></div>

    <div class="footer">
      <input id="userInput" placeholder="Type your message..." onkeydown="handleEnter(event)" />
      <button onclick="sendMessage()" id="sendButton">
        <!-- Send Icon -->
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"/>
          <path d="m21.854 2.147-10.94 10.939"/>
        </svg>
      </button>
    </div>

    <div class="credit">By Horbane and ChatGPT</div>
  </div>

  <script>
    function getTimeNow() {
      const date = new Date();
      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    function handleEnter(e) {
      if (e.key === "Enter") {
        sendMessage();
      }
    }

    async function sendMessage() {
      const input = document.getElementById("userInput");
      const chat = document.getElementById("chat");
      const text = input.value.trim();
      if (!text) return;

      input.value = "";

      // Add user message
      const userMsg = document.createElement("div");
      userMsg.className = "message user";
      userMsg.innerHTML = `${text}<div class="timestamp">${getTimeNow()}</div>`;
      chat.appendChild(userMsg);
      chat.scrollTop = chat.scrollHeight;

      // Call backend
      try {
        const res = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text })
        });

        const data = await res.json();
        const cleanReply = (data.reply || "").replace(/^(Analyzing|Thinking|Planning).*/i, "").trim();

        const botMsg = document.createElement("div");
        botMsg.className = "message bot";
        botMsg.innerHTML = `${cleanReply}<div class="timestamp">${getTimeNow()}</div>`;
        chat.appendChild(botMsg);
        chat.scrollTop = chat.scrollHeight;

      } catch (err) {
        const errMsg = document.createElement("div");
        errMsg.className = "message bot";
        errMsg.innerHTML = `⚠️ Error talking to AI<div class="timestamp">${getTimeNow()}</div>`;
        chat.appendChild(errMsg);
        chat.scrollTop = chat.scrollHeight;
      }
    }
  </script>
</body>
</html>
